<body class="bg-[#0f172a] text-gray-200 min-h-screen flex overflow-x-hidden">
  <app-sidebar-operador></app-sidebar-operador>

  <main class="flex-1 flex flex-col overflow-y-auto">
    <header
      class="h-16 bg-[#1e293b] flex items-center justify-between px-6 border-b border-gray-800"
    >
      <div>
        <h1 class="text-xl font-bold">Agregar Registro de horas</h1>
        <span class="text-sm text-gray-400">Registrar nuevo registro de horas en el sistema</span>
      </div>
    </header>

    <section class="p-6">
      <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left: fotos (col 1) -->
        <div class="lg:col-span-1 space-y-6">
          <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-white mb-3">Foto Planilla</h3>
            <div
              class="relative rounded-lg overflow-hidden border-2 border-dashed border-gray-600 bg-[#0b1220] h-48 flex items-center justify-center"
            >
              @if (fotoPlanillaPreview) {
              <img [src]="fotoPlanillaPreview" class="w-full h-full object-cover" alt="planilla" />
              } @else {
              <div class="text-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="48"
                  height="48"
                  class="mx-auto text-gray-500 mb-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path
                    d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                  ></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
                <p class="text-gray-400">Sin foto</p>
              </div>
              }
            </div>

            <input
              type="file"
              #planillaInput
              accept="image/jpeg,image/png,image/webp"
              class="hidden"
              (change)="onFileSelected('foto_planilla', $event)"
            />
            <div class="mt-3 flex gap-2">
              <button
                (click)="planillaInput.click()"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg"
              >
                Subir Foto
              </button>
              @if (fotoPlanillaPreview) {
              <button
                (click)="limpiarFoto('foto_planilla')"
                class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded-lg"
              >
                Limpiar
              </button>
              }
            </div>
            @if (errores['foto_planilla']) {
            <p class="text-red-500 text-xs mt-2">{{ errores['foto_planilla'] }}</p>
            }
            <p class="text-xs text-gray-400 mt-2">Formatos: JPG, PNG, WEBP. Máx: 5MB</p>
          </div>

          <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-white mb-3">Foto Horómetro Inicial</h3>
            <div
              class="relative rounded-lg overflow-hidden border-2 border-dashed border-gray-600 bg-[#0b1220] h-40 flex items-center justify-center"
            >
              @if (fotoHorometroInicialPreview) {
              <img
                [src]="fotoHorometroInicialPreview"
                class="w-full h-full object-cover"
                alt="horometro-inicial"
              />
              } @else {
              <div class="text-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  class="mx-auto text-gray-500 mb-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path
                    d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                  ></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
                <p class="text-gray-400">Sin foto</p>
              </div>
              }
            </div>

            <input
              type="file"
              #horometroIniInput
              accept="image/jpeg,image/png,image/webp"
              class="hidden"
              (change)="onFileSelected('foto_horometro_inicial', $event)"
            />
            <div class="mt-3 flex gap-2">
              <button
                (click)="horometroIniInput.click()"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg"
              >
                Subir Foto
              </button>
              @if (fotoHorometroInicialPreview) {
              <button
                (click)="limpiarFoto('foto_horometro_inicial')"
                class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded-lg"
              >
                Limpiar
              </button>
              }
            </div>
            @if (errores['foto_horometro_inicial']) {
            <p class="text-red-500 text-xs mt-2">{{ errores['foto_horometro_inicial'] }}</p>
            }
          </div>

          <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-white mb-3">Foto Horómetro Final</h3>
            <div
              class="relative rounded-lg overflow-hidden border-2 border-dashed border-gray-600 bg-[#0b1220] h-40 flex items-center justify-center"
            >
              @if (fotoHorometroFinalPreview) {
              <img
                [src]="fotoHorometroFinalPreview"
                class="w-full h-full object-cover"
                alt="horometro-final"
              />
              } @else {
              <div class="text-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  class="mx-auto text-gray-500 mb-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path
                    d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                  ></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
                <p class="text-gray-400">Sin foto</p>
              </div>
              }
            </div>

            <input
              type="file"
              #horometroFinInput
              accept="image/jpeg,image/png,image/webp"
              class="hidden"
              (change)="onFileSelected('foto_horometro_final', $event)"
            />
            <div class="mt-3 flex gap-2">
              <button
                (click)="horometroFinInput.click()"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg"
              >
                Subir Foto
              </button>
              @if (fotoHorometroFinalPreview) {
              <button
                (click)="limpiarFoto('foto_horometro_final')"
                class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded-lg"
              >
                Limpiar
              </button>
              }
            </div>
            @if (errores['foto_horometro_final']) {
            <p class="text-red-500 text-xs mt-2">{{ errores['foto_horometro_final'] }}</p>
            }
          </div>
        </div>

        <!-- Right: formulario (col 2-3) -->
        <div class="lg:col-span-2">
          <div class="bg-[#1e293b] border border-gray-700 rounded-2xl p-6 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-gray-300 mb-2"
                  >Máquina <span class="text-red-500">*</span></label
                >
                <select
                  [(ngModel)]="form.maquina"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white"
                >
                  <option [ngValue]="undefined">-- Seleccione máquina --</option>
                  @for (m of maquinas; track m.id_maquina) {
                  <option [ngValue]="m.id_maquina">
                    {{ m.nombre_maquina }} — {{ m.marca || '-' }} ({{ m.estado }})
                  </option>
                  }
                </select>
                @if (errores['maquina']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['maquina'] }}</p>
                }
              </div>

              <div>
                <label class="block text-sm text-gray-300 mb-2"
                  >Proyecto <span class="text-red-500">*</span></label
                >
                <select
                  [(ngModel)]="form.proyecto"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white"
                >
                  <option [ngValue]="undefined">-- Seleccione proyecto --</option>
                  @for (p of proyectos; track p.id_proyecto) {
                  <option [ngValue]="p.id_proyecto">{{ p.nombre_proyecto }}</option>
                  }
                </select>
                @if (errores['proyecto']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['proyecto'] }}</p>
                }
              </div>

              <div>
                <label class="block text-sm text-gray-300 mb-2"
                  >Responsable (usuario) <span class="text-red-500">*</span></label
                >
                <select
                  [(ngModel)]="form.usuario"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white"
                >
                  <option [ngValue]="undefined">-- Seleccione usuario --</option>
                  @for (u of usuarios; track u.id_usuario) {
                  <option [ngValue]="u.id_usuario">{{ u.nombre }} — {{ u.cargo }}</option>
                  }
                </select>
                @if (errores['usuario']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['usuario'] }}</p>
                }
              </div>

              <div>
                <label class="block text-sm text-gray-300 mb-2"
                  >Fecha <span class="text-red-500">*</span></label
                >
                <input
                  type="date"
                  [(ngModel)]="form.fecha"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white"
                />
                @if (errores['fecha']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['fecha'] }}</p>
                }
              </div>

              <div>
                <label class="block text-sm text-gray-300 mb-2"
                  >Horas trabajadas <span class="text-red-500">*</span></label
                >
                <input
                  type="number"
                  step="0.01"
                  min="0.01"
                  [(ngModel)]="form.horas_trabajadas"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white"
                />
                @if (errores['horas_trabajadas']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['horas_trabajadas'] }}</p>
                }
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm text-gray-300 mb-2">Observaciones</label>
                <textarea
                  rows="4"
                  [(ngModel)]="form.observaciones"
                  class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white resize-none"
                ></textarea>
                @if (errores['observaciones']) {
                <p class="text-red-500 text-xs mt-1">{{ errores['observaciones'] }}</p>
                }
              </div>
            </div>

            <div class="flex gap-4 mt-4">
              <button
                (click)="cancelar()"
                class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg"
              >
                Cancelar
              </button>
              <button
                (click)="crearRegistro()"
                [disabled]="creando"
                class="flex-1 bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-3 rounded-lg"
              >
                @if (creando) { Creando... } @else { Crear Registro }
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</body>
