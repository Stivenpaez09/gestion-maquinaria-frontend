<body class="bg-[#0f172a] text-gray-200 min-h-screen flex">
  <!-- SIDEBAR (igual al anterior, completo) -->
  <app-sidebar-admin></app-sidebar-admin>

  <main class="flex-1 flex flex-col overflow-hidden">
    <!-- HEADER -->
    <header
      class="h-16 bg-[#1e293b] flex items-center justify-between px-6 border-b py-11 border-gray-800"
    >
      <div>
        <h1 class="text-xl font-bold">Detalles de Maquinaria</h1>
        <span class="text-sm text-gray-400">Informaci贸n y gesti贸n completa</span>
      </div>
      <button
        (click)="activarEdicion()"
        [disabled]="cargando"
        class="bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 text-base"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          fill="#ffffff"
          viewBox="0 0 256 256"
          class="inline-block"
        >
          <path
            d="M230.15,70.54,185.46,25.86a20,20,0,0,0-28.28,0L33.86,149.17A19.86,19.86,0,0,0,28,163.31V208a20,20,0,0,0,20,20H216a12,12,0,0,0,0-24H125L230.15,98.83A20,20,0,0,0,230.15,70.54ZM91,204H52V165l84-84,39,39ZM192,103,153,64l18.34-18.34,39,39Z"
          ></path>
        </svg>
        Editar
      </button>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <section class="flex-1 overflow-y-auto p-6 space-y-8">
      @if (cargando) {
      <div class="flex items-center justify-center h-full">
        <div class="animate-spin">
          <svg
            class="w-12 h-12 text-[#f97316]"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
        </div>
      </div>
      } @else if (maquinaria) {
      <!-- MODO VISTA -->
      @if (!modoEdicion) {
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- FOTO Y ESTADO -->
        <div class="lg:col-span-1">
          <div class="bg-[#1e293b] border border-gray-700 rounded-xl overflow-hidden">
            <div class="relative h-64 bg-gradient-to-br from-[#0b1220] to-[#111827]">
              <img
                [src]="obtenerFotoUrl(maquinaria.foto)"
                [alt]="maquinaria.nombre_maquina"
                class="w-full h-full object-cover"
                onError="this.src='assets/images/maquina-default.jpeg'"
              />
            </div>
            <div class="p-6 space-y-4">
              <div>
                <p class="text-sm text-gray-400">Estado Actual</p>
                <span
                  [ngClass]="obtenerClasesEstado(maquinaria.estado)"
                  class="inline-block px-4 py-2 rounded-full text-sm font-semibold mt-2"
                >
                  {{ maquinaria.estado | uppercase }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- INFORMACIN PRINCIPAL -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Info B谩sica -->
          <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 space-y-4">
            <h2 class="text-lg font-semibold text-white flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 256 256"
              >
                <path
                  d="M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm52-84a12,12,0,0,1-12,12H140v28a12,12,0,0,1-24,0V140H88a12,12,0,0,1,0-24h28V88a12,12,0,0,1,24,0v28h28A12,12,0,0,1,180,128Z"
                ></path>
              </svg>
              Informaci贸n Principal
            </h2>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-400">ID de Maquinaria</p>
                <p class="text-white font-semibold">{{ maquinaria.id_maquina }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-400">Nombre</p>
                <p class="text-white font-semibold">{{ maquinaria.nombre_maquina }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-400">Tipo / Modelo</p>
                <p class="text-white font-semibold">{{ maquinaria.modelo || 'N/A' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-400">Marca</p>
                <p class="text-white font-semibold">{{ maquinaria.marca || 'N/A' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-400">N煤mero de Serie</p>
                <p class="text-white font-semibold">{{ maquinaria.serie || 'N/A' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-400">Horas Totales</p>
                <p class="text-white font-semibold">
                  {{ maquinaria.horas_totales | number : '1.2-2' }} h
                </p>
              </div>
            </div>
          </div>

          <!-- Informaci贸n de Fechas -->
          <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 space-y-4">
            <h3 class="text-lg font-semibold text-white">Informaci贸n de Fechas</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-400">Fecha de Adquisici贸n</p>
                <p class="text-white font-semibold">
                  {{
                    maquinaria.fecha_adquisicion
                      ? (maquinaria.fecha_adquisicion | date : 'dd/MM/yyyy')
                      : 'N/A'
                  }}
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-400">Registrado</p>
                <p class="text-white font-semibold">
                  {{ maquinaria.created_at | date : 'dd/MM/yyyy HH:mm' }}
                </p>
              </div>
            </div>
          </div>

          <!-- Botones de Acci贸n -->
          <div class="flex gap-3">
            <button
              (click)="confirmarEliminar()"
              class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="3 6 5 6 21 6"></polyline>
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                ></path>
              </svg>
              Eliminar Maquinaria
            </button>
            <button
              routerLink="/ver-maquinarias-admin"
              class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              Volver
            </button>
          </div>
        </div>
      </div>

      <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-white flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="#ffffff"
              viewBox="0 0 256 256"
            >
              <path
                d="M232,116H219.22A91.1,91.1,0,0,0,213,92.79l11.08-6.4a12,12,0,1,0-12-20.78L201,72a92.85,92.85,0,0,0-17-17l6.41-11.11a12,12,0,1,0-20.78-12L163.21,43A91.1,91.1,0,0,0,140,36.78V24a12,12,0,0,0-24,0V36.78A91.1,91.1,0,0,0,92.79,43l-6.4-11.08a12,12,0,0,0-20.78,12L72,55A92.85,92.85,0,0,0,55,72L43.93,65.61a12,12,0,0,0-12,20.78L43,92.79A91.1,91.1,0,0,0,36.78,116H24a12,12,0,0,0,0,24H36.78A91.1,91.1,0,0,0,43,163.21l-11.08,6.4a12,12,0,1,0,12,20.78L55,184a92.85,92.85,0,0,0,17,17l-6.41,11.11a12,12,0,1,0,20.78,12L92.79,213A91.1,91.1,0,0,0,116,219.22V232a12,12,0,0,0,24,0V219.22A91.1,91.1,0,0,0,163.21,213l6.4,11.08a12,12,0,0,0,20.78-12L184,201a92.85,92.85,0,0,0,17-17l11.11,6.41a12,12,0,1,0,12-20.78L213,163.21A91.1,91.1,0,0,0,219.22,140H232a12,12,0,0,0,0-24ZM128,60a68.1,68.1,0,0,1,66.92,56h-60l-30-52A67.61,67.61,0,0,1,128,60ZM60,128A67.9,67.9,0,0,1,84.16,76.07l30,51.93-30,51.93A67.9,67.9,0,0,1,60,128Zm68,68a67.61,67.61,0,0,1-23.07-4l30-52h60A68.1,68.1,0,0,1,128,196Z"
              ></path>
            </svg>
            Mantenimientos Programados
          </h2>

          <button
            (click)="abrirFormularioMantenimiento()"
            class="bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Agregar
          </button>
        </div>

        <!-- FORMULARIO AGREGAR (inline) -->
        @if (mostrarFormMantenimiento) {
        <div class="bg-[#0b1220] border border-gray-700 rounded-lg p-4 space-y-3">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="block text-sm text-gray-300 mb-1"
                >Nombre <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                [(ngModel)]="mantenimientoForm.nombre"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-3 py-2 text-white"
              />
              @if (erroresMantenimiento['nombre']) {
              <p class="text-red-500 text-xs mt-1">{{ erroresMantenimiento['nombre'] }}</p>
              }
            </div>

            <div>
              <label class="block text-sm text-gray-300 mb-1"
                >Tipo <span class="text-red-500">*</span></label
              >
              <select
                [(ngModel)]="mantenimientoForm.tipo"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-3 py-2 text-white"
              >
                <option value="" disabled selected>-- Seleccionar --</option>
                <option value="preventivo">Preventivo</option>
                <option value="predictivo">Predictivo</option>
              </select>
              @if (erroresMantenimiento['tipo']) {
              <p class="text-red-500 text-xs mt-1">{{ erroresMantenimiento['tipo'] }}</p>
              }
            </div>

            <div>
              <label class="block text-sm text-gray-300 mb-1"
                >Intervalo (horas) <span class="text-red-500">*</span></label
              >
              <input
                type="number"
                min="1"
                step="1"
                [(ngModel)]="mantenimientoForm.intervalo_horas"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-3 py-2 text-white"
              />
              @if (erroresMantenimiento['intervalo_horas']) {
              <p class="text-red-500 text-xs mt-1">{{ erroresMantenimiento['intervalo_horas'] }}</p>
              }
            </div>

            <div>
              <label class="block text-sm text-gray-300 mb-1">Descripci贸n (opcional)</label>
              <input
                type="text"
                [(ngModel)]="mantenimientoForm.descripcion"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-3 py-2 text-white"
              />
              @if (erroresMantenimiento['descripcion']) {
              <p class="text-red-500 text-xs mt-1">{{ erroresMantenimiento['descripcion'] }}</p>
              }
            </div>
          </div>

          <div class="flex gap-3 pt-3">
            <button
              (click)="cancelarFormularioMantenimiento()"
              class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg"
            >
              Cancelar
            </button>
            <button
              (click)="crearMantenimientoProgramado()"
              [disabled]="cargandoMantenimientoOperacion"
              class="flex-1 bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-2 rounded-lg"
            >
              @if (cargandoMantenimientoOperacion) { Creando... } @else { Crear Mantenimiento }
            </button>
          </div>
        </div>
        }

        <!-- LISTA DE MANTENIMIENTOS -->
        @if (cargandoMantenimientos) {
        <div class="flex items-center justify-center py-6">
          <svg
            class="animate-spin w-8 h-8 text-[#f97316]"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
            ></path>
          </svg>
        </div>
        } @else if (mantenimientos && mantenimientos.length > 0) {
        <div class="space-y-3">
          @for (m of mantenimientos; track m.id_programado) {
          <div
            (click)="abrirDetalleMantenimiento(m.id_programado)"
            class="bg-[#0b1220] border border-gray-700 rounded-lg p-4 hover:border-[#f97316] cursor-pointer transition-colors flex items-center justify-between"
          >
            <div>
              <p class="text-white font-semibold">{{ m.nombre }}</p>
              <p class="text-sm text-gray-400">
                {{ m.tipo | titlecase }} 路 Intervalo: {{ m.intervalo_horas }} h
              </p>
            </div>
            <div class="text-sm text-gray-400">Ver</div>
          </div>
          }
        </div>
        } @else {
        <p class="text-gray-400 text-center py-4">
          No hay mantenimientos programados para esta m谩quina.
        </p>
        }
      </div>

      <!-- SECCIN DE HOJAS DE VIDA -->
      <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-white flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              viewBox="0 0 256 256"
            >
              <path
                d="M200,24H56A20,20,0,0,0,36,44V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V44A20,20,0,0,0,200,24Zm-4,188H60V48H196ZM92,88h72a12,12,0,0,1,0,24H92a12,12,0,0,1,0-24Zm0,48h72a12,12,0,0,1,0,24H92a12,12,0,0,1,0-24Z"
              ></path>
            </svg>
            Hojas de Vida
          </h2>
          <button
            (click)="mostrarFormHojaVida = !mostrarFormHojaVida"
            class="bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              fill="currentColor"
              viewBox="0 0 256 256"
            >
              <path
                d="M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm52-84a12,12,0,0,1-12,12H140v28a12,12,0,0,1-24,0V140H88a12,12,0,0,1,0-24h28V88a12,12,0,0,1,24,0v28h28A12,12,0,0,1,180,128Z"
              ></path>
            </svg>
            Agregar
          </button>
        </div>

        <!-- FORMULARIO AGREGAR HOJA DE VIDA -->
        @if (mostrarFormHojaVida) {
        <div class="bg-[#0b1220] border border-gray-700 rounded-lg p-6 space-y-4">
          <!-- Usuario (opcional) -->
          <div>
            <label class="block text-sm font-medium text-gray-400 mb-2"> Usuario </label>
            <select
              [(ngModel)]="formularioHojaVida.usuario"
              class="w-full bg-[#1e293b] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
            >
              <option [ngValue]="null">-- Seleccionar usuario --</option>
              <option *ngFor="let usr of usuarios" [value]="usr.id_usuario">
                {{ usr.nombre }} {{ usr.cargo ? ' - ' + usr.cargo : '' }}
              </option>
            </select>
          </div>
          <!-- Descripci贸n -->
          <div>
            <label class="block text-sm font-medium text-gray-400 mb-2">
              Descripci贸n <span class="text-red-500">*</span>
            </label>
            <textarea
              [(ngModel)]="formularioHojaVida.descripcion"
              placeholder="Descripci贸n del documento o registro..."
              [ngClass]="{ 'border-red-500': tieneErrorHojaVida('descripcion') }"
              class="w-full bg-[#1e293b] border border-gray-700 rounded-lg px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-transparent transition h-24"
            ></textarea>
            @if (tieneErrorHojaVida('descripcion')) {
            <p class="text-red-500 text-xs mt-1">{{ obtenerErrorHojaVida('descripcion') }}</p>
            }
          </div>

          <!-- Fecha -->
          <div>
            <label class="block text-sm font-medium text-gray-400 mb-2">
              Fecha de Registro <span class="text-red-500">*</span>
            </label>
            <input
              type="date"
              [(ngModel)]="formularioHojaVida.fecha_registro"
              [ngClass]="{ 'border-red-500': tieneErrorHojaVida('fecha_registro') }"
              class="w-full bg-[#1e293b] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-transparent transition"
            />
            @if (tieneErrorHojaVida('fecha_registro')) {
            <p class="text-red-500 text-xs mt-1">{{ obtenerErrorHojaVida('fecha_registro') }}</p>
            }
          </div>

          <!-- Archivo -->
          <div>
            <label class="block text-sm font-medium text-gray-400 mb-2"> Archivo (Opcional) </label>
            <div class="flex gap-2">
              <input
                type="file"
                #archivoInput
                (change)="onArchivoSeleccionado($event)"
                class="hidden"
              />
              <button
                (click)="archivoInput.click()"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
              >
                Seleccionar Archivo
              </button>
              @if (archivoNombre) {
              <button
                (click)="limpiarArchivo()"
                class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
              >
                Limpiar
              </button>
              }
            </div>
            @if (archivoNombre) {
            <p class="text-gray-400 text-sm mt-2"> {{ archivoNombre }}</p>
            }
          </div>

          <!-- Botones -->
          <div class="flex gap-3 pt-4">
            <button
              (click)="limpiarFormularioHojaVida()"
              class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
            >
              Cancelar
            </button>
            <button
              (click)="crearHojaVida()"
              [disabled]="cargandoHojaVida"
              class="flex-1 bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2"
            >
              @if (cargandoHojaVida) {
              <svg
                class="animate-spin h-5 w-5"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
              </svg>
              Creando... } @else { Guardar Hoja de Vida }
            </button>
          </div>
        </div>
        }

        <!-- LISTA DE HOJAS DE VIDA -->
        @if (hojasVida.length > 0) {
        <div class="space-y-3">
          @for (hoja of hojasVida; track hoja.id_hoja) {
          <div
            class="bg-[#0b1220] border border-gray-700 rounded-lg p-4 flex items-start justify-between"
          >
            <div class="flex-1">
              <p class="text-white font-semibold mb-1">{{ hoja.descripcion }}</p>
              <p class="text-gray-400 text-sm">
                {{ hoja.fecha_registro | date : 'dd/MM/yyyy' }} - Registrado:
                {{ hoja.created_at | date : 'dd/MM/yyyy HH:mm' }}
              </p>
            </div>

            <div class="flex items-center gap-2 ml-4">
              <!-- Ver en nueva pesta帽a -->

              <!-- Descargar -->
              <a
                *ngIf="hoja.archivo"
                [href]="obtenerArchivoUrl(hoja.archivo)"
                download
                target="_blank"
                rel="noopener"
                class="bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg transition-colors"
                title="Descargar"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="#ffffff"
                  viewBox="0 0 256 256"
                  class="inline-block"
                >
                  <path
                    d="M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"
                  ></path>
                </svg>
                Descargar
              </a>

              <!-- Eliminar -->
              <button
                (click)="eliminarHojaVida(hoja.id_hoja)"
                class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition-colors"
                title="Eliminar"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
          }
        </div>
        } @else {
        <p class="text-gray-400 text-center py-8">No hay hojas de vida registradas</p>
        }
      </div>
      } @else {
      <div class="max-w-3xl mx-auto space-y-6">
        <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 space-y-4">
          <h2 class="text-lg font-semibold text-white">Editar Maquinaria</h2>
          <p class="text-sm text-gray-400">
            Solo puedes editar: Nombre, Modelo, Marca, Horas Totales y Estado
          </p>

          <div class="grid grid-cols-2 gap-4">
            <!-- Nombre (EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Nombre <span class="text-red-500">*</span>
                @if (camposModificados.has('nombre_maquina')) {
                <span class="text-[#f97316] text-xs font-bold">(Modificado)</span>
                }
              </label>
              <input
                type="text"
                [(ngModel)]="maquinariaEditada.nombre_maquina"
                (ngModelChange)="onCampoModificado('nombre_maquina')"
                [ngClass]="{ 'border-red-500': tieneError('nombre_maquina') }"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
              />
              @if (tieneError('nombre_maquina')) {
              <p class="text-red-500 text-xs mt-1">{{ obtenerError('nombre_maquina') }}</p>
              }
            </div>

            <!-- Modelo (EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Modelo @if (camposModificados.has('modelo')) {
                <span class="text-[#f97316] text-xs font-bold">(Modificado)</span>
                }
              </label>
              <input
                type="text"
                [(ngModel)]="maquinariaEditada.modelo"
                (ngModelChange)="onCampoModificado('modelo')"
                [ngClass]="{ 'border-red-500': tieneError('modelo') }"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
              />
              @if (tieneError('modelo')) {
              <p class="text-red-500 text-xs mt-1">{{ obtenerError('modelo') }}</p>
              }
            </div>

            <!-- Marca (EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Marca @if (camposModificados.has('marca')) {
                <span class="text-[#f97316] text-xs font-bold">(Modificado)</span>
                }
              </label>
              <input
                type="text"
                [(ngModel)]="maquinariaEditada.marca"
                (ngModelChange)="onCampoModificado('marca')"
                [ngClass]="{ 'border-red-500': tieneError('marca') }"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
              />
              @if (tieneError('marca')) {
              <p class="text-red-500 text-xs mt-1">{{ obtenerError('marca') }}</p>
              }
            </div>

            <!-- Serie (NO EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Serie <span class="text-gray-500 text-xs">(No editable)</span>
              </label>
              <input
                type="text"
                [value]="maquinariaEditada.serie"
                disabled
                class="w-full bg-gray-700/30 border border-gray-700 rounded-lg px-4 py-3 text-gray-400 cursor-not-allowed"
              />
            </div>

            <!-- Horas Totales (EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Horas Totales @if (camposModificados.has('horas_totales')) {
                <span class="text-[#f97316] text-xs font-bold">(Modificado)</span>
                }
              </label>
              <input
                type="number"
                [(ngModel)]="maquinariaEditada.horas_totales"
                (ngModelChange)="onCampoModificado('horas_totales')"
                step="0.01"
                [ngClass]="{ 'border-red-500': tieneError('horas_totales') }"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
              />
              @if (tieneError('horas_totales')) {
              <p class="text-red-500 text-xs mt-1">{{ obtenerError('horas_totales') }}</p>
              }
            </div>

            <!-- Estado (EDITABLE) -->
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">
                Estado @if (camposModificados.has('estado')) {
                <span class="text-[#f97316] text-xs font-bold">(Modificado)</span>
                }
              </label>
              <select
                [(ngModel)]="maquinariaEditada.estado"
                (ngModelChange)="onCampoModificado('estado')"
                [ngClass]="{ 'border-red-500': tieneError('estado') }"
                class="w-full bg-[#0f172a] border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#f97316]"
              >
                <option value="operativa">Operativa</option>
                <option value="en mantenimiento">En Mantenimiento</option>
                <option value="fuera de servicio">Fuera de Servicio</option>
              </select>
              @if (tieneError('estado')) {
              <p class="text-red-500 text-xs mt-1">{{ obtenerError('estado') }}</p>
              }
            </div>
          </div>

          <!-- Informaci贸n de campos no editables -->
          <div class="bg-[#0b1220] border border-gray-700 rounded-lg p-4 space-y-2">
            <p class="text-sm text-gray-400 font-semibold">Campos no editables:</p>
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div>
                <p class="text-gray-500">ID Maquinaria:</p>
                <p class="text-white font-medium">{{ maquinaria.id_maquina }}</p>
              </div>
              <div>
                <p class="text-gray-500">Fecha Adquisici贸n:</p>
                <p class="text-white font-medium">
                  {{ maquinaria.fecha_adquisicion | date : 'dd/MM/yyyy' }}
                </p>
              </div>
            </div>
          </div>

          <!-- Botones -->
          <div class="flex gap-3 pt-6">
            <button
              (click)="cancelarEdicion()"
              class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              Cancelar
            </button>
            <button
              (click)="guardarEdicion()"
              [disabled]="cargandoEdicion || camposModificados.size === 0"
              class="flex-1 bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              @if (cargandoEdicion) {
              <svg
                class="animate-spin h-5 w-5"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
              </svg>
              Guardando... } @else { Guardar Cambios ({{ camposModificados.size }} campo(s)
              modificado(s)) }
            </button>
          </div>
        </div>
      </div>
      } }
    </section>
  </main>

  <!-- MODAL CONFIRMACIN ELIMINAR -->
  @if (mostrarConfirmacionEliminar) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-[#1e293b] border border-gray-700 rounded-xl p-6 max-w-md w-full mx-4 space-y-4">
      <h2 class="text-xl font-bold text-white">Confirmar eliminaci贸n</h2>
      <p class="text-gray-400">
        驴Est谩s seguro de que deseas eliminar la maquinaria
        <strong>{{ maquinaria?.nombre_maquina }}</strong
        >? Esta acci贸n no se puede deshacer.
      </p>
      <div class="flex gap-3">
        <button
          (click)="cancelarEliminacion()"
          class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
        >
          Cancelar
        </button>
        <button
          (click)="eliminarMaquinaria()"
          [disabled]="cargandoEliminacion"
          class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2"
        >
          @if (cargandoEliminacion) {
          <svg
            class="animate-spin h-5 w-5"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
          </svg>
          Eliminando... } @else { Eliminar }
        </button>
      </div>
    </div>
  </div>
  }
</body>
