<body class="bg-[#0f172a] text-gray-200 min-h-screen flex">
  <app-sidebar-responsable></app-sidebar-responsable>

  <!-- =========================
       MAIN AREA
  ========================== -->
  <main class="flex-1 flex flex-col">
    <!-- =========================
         HEADER SUPERIOR
    ========================== -->
    <header
      class="h-16 bg-[#1e293b] flex items-center justify-between px-6 border-b py-11 border-gray-800"
    >
      <div>
        <h1 class="text-xl font-bold">Gestión de Maquinarias</h1>
        <span class="text-sm text-gray-400">Administracion y control de maquinaría</span>
      </div>
    </header>

    <!-- =========================
         CONTENIDO PRINCIPAL
    ========================== -->
    <section class="p-6 space-y-8">
      <!-- =========================
           BUSCADOR Y FILTROS
      ========================== -->
      <div class="flex flex-col gap-4">
        <!-- Buscador -->
        <div class="flex items-center gap-3">
          <div class="flex-1 relative">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (keyup.enter)="buscar()"
              placeholder="Buscar por nombre "
              class="w-full bg-[#1e293b] border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-transparent transition"
            />
          </div>

          <button
            (click)="buscar()"
            class="bg-[#f97316] hover:bg-[#ea580c] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5 active:translate-y-0 flex items-center justify-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            Buscar
          </button>
        </div>

        <!-- Filtros -->
        <div class="flex items-center gap-3 flex-wrap">
          <span class="text-gray-400 font-medium">Filtros:</span>

          <button
            (click)="cargarTodasMaquinarias()"
            [ngClass]="{
              'bg-[#f97316] text-white': filtroActual === 'todas',
              'bg-[#1e293b] text-gray-400 hover:bg-[#0b1220]': filtroActual !== 'todas'
            }"
            class="px-4 py-2 rounded-lg border border-gray-700 transition-all duration-200"
          >
            Todas
          </button>

          <button
            (click)="cargarMaquinariasEnOperacion()"
            [ngClass]="{
              'bg-blue-600 text-white': filtroActual === 'en-operacion',
              'bg-[#1e293b] text-gray-400 hover:bg-[#0b1220]': filtroActual !== 'en-operacion'
            }"
            class="px-4 py-2 rounded-lg border border-gray-700 transition-all duration-200"
          >
            En operación
          </button>

          <button
            (click)="cargarMaquinariasAlDia()"
            [ngClass]="{
              'bg-emerald-600 text-white': filtroActual === 'al-dia',
              'bg-[#1e293b] text-gray-400 hover:bg-[#0b1220]': filtroActual !== 'al-dia'
            }"
            class="px-4 py-2 rounded-lg border border-gray-700 transition-all duration-200"
          >
            Al día
          </button>

          <button
            (click)="cargarMaquinariasPendientes()"
            [ngClass]="{
              'bg-amber-600 text-white': filtroActual === 'pendientes',
              'bg-[#1e293b] text-gray-400 hover:bg-[#0b1220]': filtroActual !== 'pendientes'
            }"
            class="px-4 py-2 rounded-lg border border-gray-700 transition-all duration-200"
          >
            Pendientes
          </button>

          <button
            (click)="cargarMaquinariasVencidas()"
            [ngClass]="{
              'bg-red-600 text-white': filtroActual === 'vencidas',
              'bg-[#1e293b] text-gray-400 hover:bg-[#0b1220]': filtroActual !== 'vencidas'
            }"
            class="px-4 py-2 rounded-lg border border-gray-700 transition-all duration-200"
          >
            Vencidas
          </button>
        </div>
      </div>

      <!-- =========================
           TARJETAS DE MAQUINARIAS
      ========================== -->
      @if (maquinariosPaginados.length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (maquinaria of maquinariosPaginados; track maquinaria.id_maquina) {
        <div
          class="bg-[#1e293b] border border-gray-700 rounded-xl overflow-hidden hover:border-[#f97316] transition-all duration-300 group shadow-lg hover:shadow-xl"
        >
          <!-- Imagen -->
          <div class="relative h-48 bg-gradient-to-br from-[#0b1220] to-[#111827] overflow-hidden">
            <img
              [src]="obtenerFotoUrl(maquinaria.foto)"
              [alt]="maquinaria.nombre_maquina"
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
              onError="this.src='assets/images/maquina-default.jpeg'"
            />
            <div
              class="absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors duration-300"
            ></div>
          </div>

          <!-- Contenido -->
          <div class="p-4 space-y-3">
            <!-- Encabezado -->
            <div class="flex items-start justify-between gap-2">
              <div class="flex-1">
                <h3 class="text-lg font-bold text-white truncate">
                  {{ maquinaria.nombre_maquina }}
                </h3>
                <p class="text-sm text-gray-500">{{ maquinaria.serie || 'S/N' }}</p>
              </div>
              <span
                class="px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap"
                [ngClass]="obtenerClasesEstado(maquinaria.estado)"
              >
                {{ maquinaria.estado }}
              </span>
            </div>

            <!-- Información -->
            <div class="space-y-2 py-3 border-t border-gray-700">
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Tipo:</span>
                <span class="text-white font-medium">{{ maquinaria.modelo || 'N/A' }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Marca:</span>
                <span class="text-white font-medium">{{ maquinaria.marca || 'N/A' }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Horas:</span>
                <span class="text-white font-medium"
                  >{{ maquinaria.horas_totales | number }} h</span
                >
              </div>
            </div>

            <!-- Acciones -->
            <div class="flex gap-2 pt-3 border-t border-gray-700">
              <button
                routerLink="/detalles-maquinaria-responsable/{{ maquinaria.id_maquina }}"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2 text-sm"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Ver
              </button>
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="text-center py-12">
        <p class="text-gray-400 text-lg">No hay maquinarias disponibles</p>
      </div>
      }

      <!-- =========================
           PAGINADOR
      ========================== -->
      @if (totalPaginas > 1) {
      <div class="flex items-center justify-center gap-4 mt-8 pt-6 border-t border-gray-700">
        <button
          (click)="irAPaginaAnterior()"
          [disabled]="paginaActual === 1"
          class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-700 text-gray-400 hover:bg-[#0b1220] hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M15 6l-6 6l6 6" />
          </svg>
        </button>

        <div class="flex items-center gap-2">
          <span class="text-gray-400">Página</span>
          <input
            type="text"
            [value]="paginaActual"
            readonly
            class="w-12 h-10 text-center bg-[#0f172a] border border-gray-700 rounded-lg text-white font-semibold"
          />
          <span class="text-gray-400">de {{ totalPaginas }}</span>
        </div>

        <button
          (click)="irAPaginaSiguiente()"
          [disabled]="paginaActual === totalPaginas"
          class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-700 text-gray-400 hover:bg-[#0b1220] hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M9 6l6 6l-6 6" />
          </svg>
        </button>
      </div>
      }
    </section>
  </main>
</body>
